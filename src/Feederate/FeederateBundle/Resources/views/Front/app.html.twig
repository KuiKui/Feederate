{% extends '::angular.html.twig' %}

{% block body %}
{% verbatim %}
<div id="feederate">
    <div id="feeds">
        <div class="feeds-toolbar">
            <input ng-enter="addFeed()" ng-model="newFeedUrl" type="text" class="subscribtion" placeholder="Adding a new feed here..">
        </div>
        <div class="feeds-content">
            <ul class="nav">
                <li ng-class="{active:isActiveFeed(unread)}" id="feed_unread">
                    <a href="#summaries" ng-click="loadSummaries(unread)">
                        <span class="bullet bullet-unread pull-right" ng-show="unread.unread_count">{{ unread.unread_count }}</span>
                        <span class="title">Unread</span>
                    </a>
                </li>
                <li ng-class="{active:isActiveFeed(starred)}" id="feed_starred">
                    <a href="#summaries" ng-click="loadSummaries(starred)">
                        <span class="bullet bullet-unread pull-right" ng-show="starred.unread_count">{{ starred.unread_count }}</span>
                        <span class="title">Starred</span>
                    </a>
                </li>
                <li ng-repeat="feed in getShownFeeds() | objectToArray | orderBy:'title'" ng-class="{active:isActiveFeed(feed)}" id="feed_{{ feed.id }}">
                    <a href="#summaries" ng-click="loadSummaries(feed)">
                        <span class="bullet bullet-unread pull-right" ng-show="feed.unread_count">{{ feed.unread_count }}</span>
                        <span class="title">{{ feed.title }}</span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="feeds-footer">
            <button type="button" class="btn btn-default btn-sm" ng-click="markFeedAsRead(activeFeed)" ng-disabled="!activeFeed.unread_count" title="Mark {{ activeFeed.title }} as read">
                <span class="glyphicon glyphicon-ok-circle"></span>
            </button>
            <button type="button" class="btn btn-default btn-sm" ng-click="deleteFeed(activeFeed)" ng-disabled="isActiveFeed(unread) || isActiveFeed(starred)" title="Delete feed {{ activeFeed.title }}">
                <span class="glyphicon glyphicon-trash"></span>
            </button>
            <div class="pull-right">
                <button type="button" class="btn btn-default btn-sm" ng-click="toggleReadFeeds()" title="{{ user.is_read_feeds_hidden ? 'Show' : 'Hide' }} read feeds">
                    <span class="glyphicon glyphicon-{{ user.is_read_feeds_hidden ? 'open' : 'save' }}"></span>
                </button>
            </div>
        </div>
    </div>
    <div id="summaries">
        <div class="summaries-content" infinite-scroll="loadSummaries(activeFeed, false)" infinite-scroll-distance="1" infinite-scroll-disabled="summaryLoadIsBusy()" infinite-scroll-immediate-check="false">
            <div>
                <div ng-repeat="day in summariesDays" ng-class="{day: isUnreadFeed(activeFeed)}">
                    <div ng-show="isUnreadFeed(activeFeed)" class="day-group">{{ day | formatDate:'short' }}</div>
                    <ul class="nav">
                        <li ng-repeat="summary in summaries[day]" ng-class="{active:isActiveSummary(summary),read: summary.is_read}">
                            <a href="#entry" ng-click="loadEntry(summary); markAsRead(summary, true);">
                                <span ng-show="summary.is_starred" class="label label-primary">starred</span>
                                <div class="metadata">
                                    <span class="date pull-right" title="{{ summary.generated_at | formatDate:'YYYY-MM-DD h:mm A' }}">{{ summary.generated_at | formatDate:'short' }}</span>
                                    <span class="title">{{ feeds[summary.feed_id].title }}</span>
                                </div>
                                <h4>{{ summary.title }}</h4>
                                <p ng-bind-html="summary.description | characters:100"></p>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div ng-show='summariesAreLoading' class="loader"></div>
        </div>
    </div>
    <div id="entry" ng-show="activeSummary">
        <div class="entry-toolbar">
            <span class="pull-right">
                <a class="glyphicon" title="{{ activeSummary.is_read ? 'Mark as unread' : 'Mark as read' }}" ng-click="markAsRead(activeSummary)" ng-class="{'glyphicon glyphicon-ok-sign': !activeSummary.is_read, 'glyphicon glyphicon-ok-circle': activeSummary.is_read}"></a>
                <a class="glyphicon" title="{{ activeSummary.is_starred ? 'Unstar' : 'Star' }}" ng-click="markAsStarred(activeSummary)" ng-class="{'glyphicon-star-empty': !activeSummary.is_starred, 'glyphicon-star': activeSummary.is_starred}"></a>
            </span>
            <a target="_blank" href="{{ feeds[activeSummary.feed_id].target_url }}">{{ feeds[activeSummary.feed_id].title }}</a>
        </div>
        <div class="entry-content">
            <div class="container">
                <h2><a target="_blank" href="{{ entry.target_url }}">{{ entry.title }}</a></h2>
                <div class="date">{{ entry.generated_at | formatDate:'MMMM D, YYYY' }} at {{ entry.generated_at | formatDate:'h:mm A' }}</div>
                <div entry-content-bind="entry.content"></div>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
{% endblock %}
